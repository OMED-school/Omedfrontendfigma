<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - OMED Documentation</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/doc-page.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <span class="logo-text">OMED Documentation</span>
            </a>
            <a href="index.html" class="btn btn-secondary btn-sm">← Back to Home</a>
        </div>
    </nav>
    <main class="doc-container">
        <div class="container">
            <article class="doc-content">
                <h1>⚡ API Reference</h1>
                <p>This document describes the custom React hooks and functions available in the OMED platform.</p>

                <h2>Authentication Hooks</h2>
                <h3>useAuth()</h3>
                <p>Access authentication context throughout the application.</p>
                <div class="code-block"><code>const { user, loading, login, logout, signup } = useAuth();</code></div>
                <p><strong>Returns:</strong></p>
                <ul>
                    <li><code>user</code> - Current authenticated user or null</li>
                    <li><code>loading</code> - Boolean indicating auth state loading</li>
                    <li><code>login(email, password)</code> - Function to log in</li>
                    <li><code>logout()</code> - Function to log out</li>
                    <li><code>signup(email, password, name)</code> - Function to register</li>
                </ul>

                <h2>Data Hooks</h2>
                <h3>useIdeas(userId?)</h3>
                <p>Fetch all ideas with real-time updates.</p>
                <div class="code-block"><code>const { ideas, loading, error, refresh } = useIdeas(user?.id);</code></div>
                <p><strong>Parameters:</strong></p>
                <ul>
                    <li><code>userId</code> (optional) - Filter ideas by author</li>
                </ul>
                <p><strong>Returns:</strong></p>
                <ul>
                    <li><code>ideas</code> - Array of idea objects</li>
                    <li><code>loading</code> - Boolean indicating loading state</li>
                    <li><code>error</code> - Error object if query failed</li>
                    <li><code>refresh()</code> - Function to manually refresh data</li>
                </ul>

                <h3>useComments(ideaId, userId)</h3>
                <p>Fetch comments for a specific idea.</p>
                <div class="code-block"><code>const { comments, loading, addComment, deleteComment } = useComments(ideaId, userId);</code></div>
                <p><strong>Parameters:</strong></p>
                <ul>
                    <li><code>ideaId</code> - ID of the idea to fetch comments for</li>
                    <li><code>userId</code> - Current user ID for permissions</li>
                </ul>
                <p><strong>Returns:</strong></p>
                <ul>
                    <li><code>comments</code> - Array of nested comment objects</li>
                    <li><code>loading</code> - Boolean loading state</li>
                    <li><code>addComment(text, parentId?)</code> - Add a comment or reply</li>
                    <li><code>deleteComment(commentId)</code> - Delete a comment</li>
                </ul>

                <h3>useVote()</h3>
                <p>Vote on ideas.</p>
                <div class="code-block"><code>const { vote, loading } = useVote();</code></div>
                <p><strong>Returns:</strong></p>
                <ul>
                    <li><code>vote(ideaId, userId, voteType)</code> - Cast or change vote</li>
                    <li><code>loading</code> - Boolean loading state</li>
                </ul>
                <p><strong>Vote Types:</strong></p>
                <ul>
                    <li><code>1</code> - Upvote</li>
                    <li><code>-1</code> - Downvote</li>
                    <li><code>0</code> - Remove vote</li>
                </ul>

                <h3>useMessages(currentUserId, recipientId)</h3>
                <p>Real-time chat messages between two users.</p>
                <div class="code-block"><code>const { messages, sendMessage, loading } = useMessages(user.id, recipientId);</code></div>
                <p><strong>Returns:</strong></p>
                <ul>
                    <li><code>messages</code> - Array of message objects</li>
                    <li><code>sendMessage(text)</code> - Send a new message</li>
                    <li><code>loading</code> - Boolean loading state</li>
                </ul>

                <h2>Action Hooks</h2>
                <h3>useIdeaActions()</h3>
                <p>Create and update ideas.</p>
                <div class="code-block"><code>const { createIdea, updateIdea, deleteIdea } = useIdeaActions();</code></div>
                <p><strong>Functions:</strong></p>
                <ul>
                    <li><code>createIdea({ title, description, category, authorId })</code></li>
                    <li><code>updateIdea(ideaId, updates)</code></li>
                    <li><code>deleteIdea(ideaId)</code></li>
                </ul>

                <h2>Supabase Client</h2>
                <h3>Import</h3>
                <div class="code-block"><code>import { supabase } from '@/lib/supabaseClient';</code></div>
                <h3>Common Operations</h3>
                <h4>Query Data</h4>
                <div class="code-block"><code>const { data, error } = await supabase
  .from('ideas')
  .select('*')
  .eq('status', 'approved')
  .order('created_at', { ascending: false });</code></div>

                <h4>Insert Data</h4>
                <div class="code-block"><code>const { data, error } = await supabase
  .from('ideas')
  .insert([{ title: 'New Idea', author_id: userId }])
  .select();</code></div>

                <h4>Update Data</h4>
                <div class="code-block"><code>const { data, error } = await supabase
  .from('ideas')
  .update({ status: 'approved' })
  .eq('id', ideaId);</code></div>

                <h4>Delete Data</h4>
                <div class="code-block"><code>const { error } = await supabase
  .from('ideas')
  .delete()
  .eq('id', ideaId);</code></div>

                <h4>Real-time Subscription</h4>
                <div class="code-block"><code>const subscription = supabase
  .channel('ideas_changes')
  .on('postgres_changes', 
    { event: '*', schema: 'public', table: 'ideas' },
    (payload) => {
      console.log('Change received!', payload);
    }
  )
  .subscribe();

// Cleanup
subscription.unsubscribe();</code></div>

                <h2>Type Definitions</h2>
                <h3>User</h3>
                <div class="code-block"><code>interface User {
  id: string;
  email: string;
  name: string;
  role: 'student' | 'teacher' | 'principal' | 'admin';
  created_at: string;
}</code></div>

                <h3>Idea</h3>
                <div class="code-block"><code>interface Idea {
  id: string;
  title: string;
  description: string;
  category: string;
  author_id: string;
  author: User;
  votes: number;
  comments_count: number;
  status: 'pending' | 'under_review' | 'approved' | 'rejected';
  created_at: string;
  updated_at: string;
}</code></div>

                <h3>Comment</h3>
                <div class="code-block"><code>interface Comment {
  id: string;
  idea_id: string;
  author_id: string;
  author: User;
  text: string;
  parent_id: string | null;
  replies?: Comment[];
  created_at: string;
}</code></div>

                <h2>Environment Variables</h2>
                <p>Configure in <code>src/utils/supabase/info.tsx</code>:</p>
                <div class="code-block"><code>export const projectId = 'your-project-id';
export const publicAnonKey = 'your-anon-key';</code></div>

                <p><strong>Recommendation:</strong> Move to <code>.env</code> file for better security:</p>
                <div class="code-block"><code>VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key</code></div>

                <h2>Helper Functions</h2>
                <h3>Format Date</h3>
                <div class="code-block"><code>import { formatDate } from '@/utils/formatters';

const formatted = formatDate(idea.created_at);
// Returns: "Jan 15, 2024"</code></div>

                <h3>Validate Email</h3>
                <div class="code-block"><code>import { isValidEmail } from '@/utils/validators';

const valid = isValidEmail('user@example.com');</code></div>

                <h2>Error Handling</h2>
                <p>All Supabase operations return errors in a consistent format:</p>
                <div class="code-block"><code>const { data, error } = await supabase.from('ideas').select('*');

if (error) {
  console.error('Database error:', error.message);
  // Handle error appropriately
}</code></div>

                <h2>Best Practices</h2>
                <ul>
                    <li>Always check for errors after Supabase operations</li>
                    <li>Use TypeScript types for better type safety</li>
                    <li>Clean up subscriptions on component unmount</li>
                    <li>Batch related queries when possible</li>
                    <li>Use RLS policies instead of client-side filtering</li>
                    <li>Handle loading and error states in UI</li>
                </ul>
            </article>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>© 2024 OMED School Platform. <a href="index.html">Back to Documentation Home</a></p>
            </div>
        </div>
    </footer>
</body>
</html>
