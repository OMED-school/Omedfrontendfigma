<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Setup Guide - OMED Documentation</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/doc-page.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <span class="logo-text">OMED Documentation</span>
            </a>
            <a href="index.html" class="btn btn-secondary btn-sm">← Back to Home</a>
        </div>
    </nav>

    <main class="doc-container">
        <div class="container">
            <article class="doc-content">
                <h1>Supabase Setup Instructions</h1><p>This application now uses Supabase for backend services instead of mock data. Follow these steps to configure your Supabase integration.</p><h2>Prerequisites</h2><ul>
<li>A Supabase account (sign up at <a href="https://supabase.com">supabase.com</a>)</li>
<li>Node.js and npm installed</li>
</ul><h2>Setup Steps</h2><h3>1. Create a Supabase Project</h3><p>1. Go to <a href="https://supabase.com">supabase.com</a> and create a new project
2. Wait for the project to be provisioned (this may take a few minutes)</p><h3>2. Configure Database Schema</h3><p>Run the following SQL scripts in the Supabase SQL Editor (found in the Supabase dashboard):</p><h4>Create Tables</h4><p>``<code>sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";</p><p>-- Profiles table (extends Supabase auth.users)
CREATE TABLE profiles (
  id UUID REFERENCES auth.users PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  full_name TEXT,
  role TEXT NOT NULL CHECK (role IN ('student', 'teacher', 'principal')),
  avatar_url TEXT,
  join_date TIMESTAMP DEFAULT NOW(),
  reputation INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</p><p>-- Ideas table
CREATE TABLE ideas (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  author_id UUID REFERENCES profiles(id) NOT NULL,
  category TEXT NOT NULL,
  votes INTEGER DEFAULT 0,
  comment_count INTEGER DEFAULT 0,
  status TEXT DEFAULT 'new' CHECK (status IN ('new', 'under-review', 'forwarded', 'approved', 'rejected')),
  principal<em>status TEXT CHECK (principal</em>status IN ('pending', 'in-progress', 'approved', 'rejected', 'implemented')),
  priority TEXT CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
  budget NUMERIC(10, 2),
  implementation_date DATE,
  teacher_notes TEXT,
  principal_notes TEXT,
  reviewed_by UUID REFERENCES profiles(id),
  forwarded_date TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</p><p>-- Votes table
CREATE TABLE votes (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  user_id UUID REFERENCES profiles(id) NOT NULL,
  idea_id UUID REFERENCES ideas(id) ON DELETE CASCADE NOT NULL,
  vote<em>type TEXT NOT NULL CHECK (vote</em>type IN ('up', 'down')),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user<em>id, idea</em>id)
);</p><p>-- Comments table
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  idea_id UUID REFERENCES ideas(id) ON DELETE CASCADE NOT NULL,
  author_id UUID REFERENCES profiles(id) NOT NULL,
  content TEXT NOT NULL,
  parent_id UUID REFERENCES comments(id) ON DELETE CASCADE,
  votes INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);</p><p>-- Comment votes table
CREATE TABLE comment_votes (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  user_id UUID REFERENCES profiles(id) NOT NULL,
  comment_id UUID REFERENCES comments(id) ON DELETE CASCADE NOT NULL,
  vote<em>type TEXT NOT NULL CHECK (vote</em>type IN ('up', 'down')),
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user<em>id, comment</em>id)
);</p><p>-- Messages table (for chat)
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  sender_id UUID REFERENCES profiles(id) NOT NULL,
  recipient_id UUID REFERENCES profiles(id) NOT NULL,
  content TEXT NOT NULL,
  read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);</p><p>-- Notifications table
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT uuid<em>generate</em>v4(),
  user_id UUID REFERENCES profiles(id) NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('comment', 'vote', 'status_change', 'message')),
  content TEXT NOT NULL,
  link TEXT,
  read BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);
</code>`<code></p><h4>Enable Row Level Security (RLS)</h4><p></code>`<code>sql
-- Enable RLS on all tables
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE ideas ENABLE ROW LEVEL SECURITY;
ALTER TABLE votes ENABLE ROW LEVEL SECURITY;
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE comment_votes ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;</p><p>-- Profiles policies
CREATE POLICY "Profiles are viewable by everyone" ON profiles
  FOR SELECT USING (true);</p><p>CREATE POLICY "Users can update own profile" ON profiles
  FOR UPDATE USING (auth.uid() = id);</p><p>CREATE POLICY "Users can insert own profile" ON profiles
  FOR INSERT WITH CHECK (auth.uid() = id);</p><p>-- Ideas policies
CREATE POLICY "Ideas are viewable by everyone" ON ideas
  FOR SELECT USING (true);</p><p>CREATE POLICY "Authenticated users can create ideas" ON ideas
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');</p><p>CREATE POLICY "Authors can update their own ideas" ON ideas
  FOR UPDATE USING (auth.uid() = author_id);</p><p>CREATE POLICY "Teachers and principals can update idea status" ON ideas
  FOR UPDATE USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE id = auth.uid() 
      AND role IN ('teacher', 'principal')
    )
  );</p><p>-- Votes policies
CREATE POLICY "Users can view all votes" ON votes
  FOR SELECT USING (true);</p><p>CREATE POLICY "Users can insert their own votes" ON votes
  FOR INSERT WITH CHECK (auth.uid() = user_id);</p><p>CREATE POLICY "Users can delete their own votes" ON votes
  FOR DELETE USING (auth.uid() = user_id);</p><p>CREATE POLICY "Users can update their own votes" ON votes
  FOR UPDATE USING (auth.uid() = user_id);</p><p>-- Comments policies
CREATE POLICY "Comments are viewable by everyone" ON comments
  FOR SELECT USING (true);</p><p>CREATE POLICY "Authenticated users can create comments" ON comments
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');</p><p>CREATE POLICY "Authors can update own comments" ON comments
  FOR UPDATE USING (auth.uid() = author_id);</p><p>-- Comment votes policies
CREATE POLICY "Users can view all comment votes" ON comment_votes
  FOR SELECT USING (true);</p><p>CREATE POLICY "Users can insert their own comment votes" ON comment_votes
  FOR INSERT WITH CHECK (auth.uid() = user_id);</p><p>CREATE POLICY "Users can delete their own comment votes" ON comment_votes
  FOR DELETE USING (auth.uid() = user_id);</p><p>CREATE POLICY "Users can update their own comment votes" ON comment_votes
  FOR UPDATE USING (auth.uid() = user_id);</p><p>-- Messages policies
CREATE POLICY "Users can view their own messages" ON messages
  FOR SELECT USING (
    auth.uid() = sender<em>id OR auth.uid() = recipient</em>id
  );</p><p>CREATE POLICY "Users can send messages" ON messages
  FOR INSERT WITH CHECK (auth.uid() = sender_id);</p><p>CREATE POLICY "Users can update their own messages" ON messages
  FOR UPDATE USING (auth.uid() = recipient_id);</p><p>-- Notifications policies
CREATE POLICY "Users can view own notifications" ON notifications
  FOR SELECT USING (auth.uid() = user_id);</p><p>CREATE POLICY "Users can update own notifications" ON notifications
  FOR UPDATE USING (auth.uid() = user_id);
</code>`<code></p><h4>Create Database Functions and Triggers</h4><p></code>`<code>sql
-- Function to automatically update vote count when a vote is added/removed
CREATE OR REPLACE FUNCTION update<em>idea</em>vote_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE ideas 
    SET votes = votes + (CASE WHEN NEW.vote_type = 'up' THEN 1 ELSE -1 END)
    WHERE id = NEW.idea_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE ideas 
    SET votes = votes - (CASE WHEN OLD.vote_type = 'up' THEN 1 ELSE -1 END)
    WHERE id = OLD.idea_id;
  ELSIF TG_OP = 'UPDATE' THEN
    UPDATE ideas 
    SET votes = votes + (CASE WHEN NEW.vote_type = 'up' THEN 1 ELSE -1 END)
<ul>
<li>(CASE WHEN OLD.vote_type = 'up' THEN 1 ELSE -1 END)</li>
</ul>
    WHERE id = NEW.idea_id;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;</p><p>-- Trigger for vote count
CREATE TRIGGER update<em>idea</em>votes
AFTER INSERT OR UPDATE OR DELETE ON votes
FOR EACH ROW EXECUTE FUNCTION update<em>idea</em>vote_count();</p><p>-- Function to update comment count
CREATE OR REPLACE FUNCTION update<em>comment</em>count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE ideas SET comment<em>count = comment</em>count + 1 WHERE id = NEW.idea_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE ideas SET comment<em>count = comment</em>count - 1 WHERE id = OLD.idea_id;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;</p><p>-- Trigger for comment count
CREATE TRIGGER update<em>idea</em>comment_count
AFTER INSERT OR DELETE ON comments
FOR EACH ROW EXECUTE FUNCTION update<em>comment</em>count();</p><p>-- Function to update comment vote count
CREATE OR REPLACE FUNCTION update<em>comment</em>vote_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE comments 
    SET votes = votes + (CASE WHEN NEW.vote_type = 'up' THEN 1 ELSE -1 END)
    WHERE id = NEW.comment_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE comments 
    SET votes = votes - (CASE WHEN OLD.vote_type = 'up' THEN 1 ELSE -1 END)
    WHERE id = OLD.comment_id;
  ELSIF TG_OP = 'UPDATE' THEN
    UPDATE comments 
    SET votes = votes + (CASE WHEN NEW.vote_type = 'up' THEN 1 ELSE -1 END)
<ul>
<li>(CASE WHEN OLD.vote_type = 'up' THEN 1 ELSE -1 END)</li>
</ul>
    WHERE id = NEW.comment_id;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;</p><p>-- Trigger for comment vote count
CREATE TRIGGER update<em>comment</em>votes
AFTER INSERT OR UPDATE OR DELETE ON comment_votes
FOR EACH ROW EXECUTE FUNCTION update<em>comment</em>vote_count();</p><p>-- Function to update timestamps
CREATE OR REPLACE FUNCTION update<em>updated</em>at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;</p><p>-- Apply to all tables with updated_at
CREATE TRIGGER update<em>profiles</em>updated_at BEFORE UPDATE ON profiles
  FOR EACH ROW EXECUTE FUNCTION update<em>updated</em>at();</p><p>CREATE TRIGGER update<em>ideas</em>updated_at BEFORE UPDATE ON ideas
  FOR EACH ROW EXECUTE FUNCTION update<em>updated</em>at();</p><p>CREATE TRIGGER update<em>comments</em>updated_at BEFORE UPDATE ON comments
  FOR EACH ROW EXECUTE FUNCTION update<em>updated</em>at();
</code>`<code></p><h3>3. Update Supabase Configuration</h3><p>The application is configured to use the Supabase project credentials from </code>src/utils/supabase/info.tsx<code>. </p><p>Update this file with your project details:</p><p></code>`<code>tsx
export const projectId = "your-project-id"
export const publicAnonKey = "your-anon-key"
</code>`<code></p><p>You can find these values in your Supabase project settings:
<ul>
<li>Project ID: Settings → General → Reference ID</li>
<li>Anon Key: Settings → API → Project API keys → anon public</li>
</ul><h3>4. Enable Authentication</h3><p>1. Go to Authentication → Providers in your Supabase dashboard
2. Enable Email provider
3. Optionally configure email templates for better user experience
4. (Optional) Enable additional OAuth providers (Google, GitHub, etc.)</p><h3>5. Create Test Users</h3><p>You can create test users through the Supabase Authentication dashboard or by signing up through the app.</p><p>For testing purposes, you may want to create users with different roles:
<ul>
<li>Student user</li>
<li>Teacher user</li>
<li>Principal user</li>
</ul><p><strong>Note:</strong> After creating a user through the auth system, you'll need to manually create a profile record or set up a database trigger to auto-create profiles.</p><h3>6. Install Dependencies</h3><p></code>`<code>bash
npm install
</code>`<code></p><h3>7. Run the Application</h3><p></code>`<code>bash
npm run dev
</code>`<code></p><h2>Features Now Using Supabase</h2><ul>
<li>✅ User authentication (login/signup)</li>
<li>✅ Ideas creation and management</li>
<li>✅ Voting on ideas</li>
<li>✅ Comments and nested replies</li>
<li>✅ Vote on comments</li>
<li>✅ Real-time updates (via Supabase Realtime)</li>
<li>✅ Chat/messaging system</li>
<li>✅ Role-based access (student, teacher, principal)</li>
</ul><h2>Troubleshooting</h2><h3>"Row Level Security" errors</h3>
Make sure you've run all the RLS policies in the setup steps above.</p><h3>Users can't create profiles</h3>
You may need to create a database trigger to automatically create a profile when a user signs up. Add this trigger:</p><p></code>`<code>sql
CREATE OR REPLACE FUNCTION public.handle<em>new</em>user()
RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, username, full_name, role)
  VALUES (new.id, new.email, new.raw<em>user</em>meta_data->>'name', 'student');
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;</p><p>CREATE TRIGGER on<em>auth</em>user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle<em>new</em>user();
</code>``</p><h3>Real-time updates not working</h3>
Make sure Realtime is enabled for your tables in Supabase:
1. Go to Database → Replication
2. Enable replication for all tables</p><h2>Additional Resources</h2><ul>
<li><a href="https://supabase.com/docs">Supabase Documentation</a></li>
<li><a href="https://supabase.com/docs/reference/javascript/introduction">Supabase JavaScript Client</a></li>
<li><a href="https://supabase.com/docs/guides/auth/row-level-security">Row Level Security Guide</a></li>
</ul>
            </article>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>© 2024 OMED School Platform. <a href="index.html">Back to Documentation Home</a></p>
            </div>
        </div>
    </footer>
</body>
</html>
